YUI.add("moodle-course-dialogadd",function(e,t){var n={PANELCONTENT:"#panelContentAdd",FORMOPPONENT:"#mform1",FORMCONTAINER:"#panelContentAdd #mform1",SUBMITBUTTON:"#panelContentAdd .hidden .felement.fgroup #id_submitbutton",SUBMITBUTTON2:"#panelContentAdd .hidden .felement.fgroup #id_submitbutton2",CANCELBUTTON:"#panelContentAdd .hidden .felement.fgroup #id_cancel",CANCELBUTTON2:"#panelContentAdd .yui3-widget-hd .yui3-button.yui3-button-close",COURSEVIEW:"#page-course-view-weeks",FORM:"mform1",URL:".moodle-dialogue-base #chooserform input[type=hidden][name=jump]",HEADER:".moodle-dialogue-base #chooserform .option.selected .typename",INITBUTTON:".moodle-dialogue-base .submitbutton[type=submit][value=Add]",JSVALIDATE:'head script[src="http://localhost/moodle/course/modavjs.js"]',JSFORM:'head script[src="http://localhost/moodle/course/modajs.js"]',SECTION:'#panelContentAdd input[name="section"]'},r="course-dialogadd",i=function(){i.superclass.constructor.apply(this,arguments)};e.extend(i,e.Base,{change_submit:function(){e.on("domready",function(){e.one(n.SUBMITBUTTON2).on("click",this.submit_click,this)},this)},submit_click:function(t){t.preventDefault(),e.one(n.CANCELBUTTON).set("disabled","disabled"),e.one(n.SUBMITBUTTON)!==null&&e.one(n.SUBMITBUTTON).set("disabled","disabled");var r={method:"post",on:{success:this.post_success},arguments:this,form:{id:n.FORM}};e.io(M.cfg.wwwroot+"/course/modedit.php?isformajax=1",r)},post_success:function(t,r,i){if(r.responseText.indexOf(n.FORM)===-1){var s=document.URL,o={},u=s.substr(s.search("id")).split("&");for(var a in u){var f=u[a].split("=");f[1]=f[1].search("#section")!=-1?f[1].substr(0,f[1].search("#section")):f[1],o[decodeURIComponent(f[0])]=decodeURIComponent(f[1])}var l="#section-"+e.one(n.SECTION).get("value"),c={on:{success:i.update_course},arguments:[this,l]};s=M.cfg.wwwroot+"/course/view.php?id="+o.id,e.io(s,c)}else i.show_form(t,r)},update_course:function(t,n,r){document.open(),document.write(n.responseText),document.close();var i=new e.Anim({node:e.UA.gecko?"html":"body",to:{scrollTop:e.one(r[1]).getY()},duration:.5,easing:e.Easing.easeBoth});i.run()},show_form:function(t,r,i){e.one(n.PANELCONTENT)!==null&&e.one(n.PANELCONTENT).remove();var s=e.all(n.FORMOPPONENT);for(var o=0;o<s.size();o++)s.item(o).remove();e.one(n.JSVALIDATE)!==null&&(e.one(n.JSVALIDATE).remove(),e.one(n.JSFORM).remove());var u=e.Node.create("<div>");u.set("id","panelContentAdd"),e.one(n.COURSEVIEW).appendChild(u),u.setContent(r.responseText),e.one(n.FORMCONTAINER).setStyle("height","500"),e.one(n.FORMCONTAINER).setStyle("overflow","auto"),e.Get.js(M.cfg.wwwroot+"/lib/javascript-static.js"),e.Get.js(M.cfg.wwwroot+"/course/modavjs.js"),e.Get.js(M.cfg.wwwroot+"/course/modajs.js");var a=new e.Panel({srcNode:n.PANELCONTENT,headerContent:"Add "+i[1],width:1e3,zIndex:5,centered:!0,modal:!0,visible:!1,render:!0,plugins:[]});e.one(n.PANELCONTENT).getY()<50&&e.one(n.PANELCONTENT).setY(50),a.show();var f=new e.Anim({node:e.UA.gecko?"html":"body",to:{scrollTop:u.getY()},duration:.5,easing:e.Easing.easeBoth});f.run(),e.fire("domready"),e.one(n.CANCELBUTTON).on("click",function(e){e.preventDefault(),a.hide()},this)},on_click:function(t){t.preventDefault();var r=e.one(n.HEADER).get("text"),i,s={on:{success:this.show_form},arguments:[this,r]};i=e.one(n.URL).get("value")+"&isformajax=1",e.io(i,s)},init:function(){M.course.coursebase.register_module(this)},setupDialog:function(){e.one(n.INITBUTTON).once("click",this.on_click,this)},detachDialog:function(){e.one(n.INITBUTTON).detach("click",this.on_click)}},{NAME:r,ATTRS:{maxheight:{value:800}}}),M.course=M.course||{},M.course.dialogadd=function(e){return new i(e)}},"@VERSION@",{requires:["io-base","io-form","anim","moodle-course-coursebase"]});
