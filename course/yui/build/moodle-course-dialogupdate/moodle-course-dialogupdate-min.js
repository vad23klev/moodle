YUI.add("moodle-course-dialogupdate",function(e,t){var n={PANELCONTENT:"#panelContentUpdate",FORMOPPONENT:"#mform1",FORMCONTAINER:"#panelContentUpdate #mform1",SUBMITBUTTON2:"#panelContentUpdate .hidden  #id_submitbutton2",SUBMITBUTTON:"#panelContentUpdate .hidden  #id_submitbutton",CANCELBUTTON:"#panelContentUpdate .hidden  #id_cancel",CANCELBUTTON2:"#panelContentUpdate .yui3-widget-hd .yui3-button.yui3-button-close",COURSEVIEW:"#page-course-view-weeks",FORM:"mform1",INITBUTTON:"a.editing_update.menu-action.cm-edit-action",DUPLICATEBUTTON:"a.editing_duplicate.menu-action.cm-edit-action",JSVALIDATE:'head script[src="http://localhost/moodle/course/moduvjs.js"]',JSFORM:'head script[src="http://localhost/moodle/course/modujs.js"]',SECTION:'#panelContentUpdate input[name="section"]',MODULENAME:'#panelContentUpdate input[name="modulename"]'},r="course-dialogupdate",i=function(){i.superclass.constructor.apply(this,arguments)};e.extend(i,e.Base,{change_submit:function(){e.on("domready",function(){e.one(n.SUBMITBUTTON2).on("click",this.submit_click,this)},this)},submit_click:function(t){t.preventDefault(),e.one(n.CANCELBUTTON).set("disabled","disabled"),e.one(n.SUBMITBUTTON)!==null&&e.one(n.SUBMITBUTTON).set("disabled","disabled");var r={method:"post",on:{success:this.post_success},arguments:this,form:{id:n.FORM}};e.io(M.cfg.wwwroot+"/course/modedit.php?isformajax=2",r)},post_success:function(t,r,i){if(r.responseText.indexOf(n.FORM)===-1){var s=document.URL,o={},u=s.substr(s.search("id")).split("&");for(var a in u){var f=u[a].split("=");f[1]=f[1].search("#section")!=-1?f[1].substr(0,f[1].search("#section")):f[1],o[decodeURIComponent(f[0])]=decodeURIComponent(f[1])}var l="#section-"+e.one(n.SECTION).get("value"),c={on:{success:i.update_course},arguments:[this,l]};s=M.cfg.wwwroot+"/course/view.php?id="+o.id,e.io(s,c)}else i.show_form(t,r)},update_course:function(t,n,r){document.open(),document.write(n.responseText),document.close();var i=new e.Anim({node:e.UA.gecko?"html":"body",to:{scrollTop:e.one(r[1]).getY()},duration:.5,easing:e.Easing.easeBoth});i.run()},show_form:function(t,r,i){var s;e.one(n.PANELCONTENT)!==null&&(s=e.one(n.MODULENAME).get("value"),typeof i=="undefined"&&(i=e.one(n.PANELCONTENT).one("[name="+s+"]").get("value")),e.one(n.PANELCONTENT).remove());var o=e.all(n.FORMOPPONENT);for(var u=0;u<o.size();u++)o.item(u).remove();e.one(n.JSVALIDATE)!==null&&(e.one(n.JSVALIDATE).remove(),e.one(n.JSFORM).remove());var a=e.Node.create("<div>");a.set("id","panelContentUpdate"),e.one(n.COURSEVIEW).appendChild(a),a.setContent(r.responseText),e.one(n.FORMCONTAINER).setStyle("height","500"),e.one(n.FORMCONTAINER).setStyle("overflow","auto"),e.Get.js(M.cfg.wwwroot+"/lib/javascript-static.js"),e.Get.js(M.cfg.wwwroot+"/course/moduvjs.js"),e.Get.js(M.cfg.wwwroot+"/course/modujs.js"),s=e.one(n.MODULENAME).get("value"),typeof i=="object"&&(i=i[1][s]);var f=e.Node.create("<input>");f.set("name",s),f.set("value",i),e.one(n.PANELCONTENT).one('[style="display: none;"]').append(f);var l=new e.Panel({srcNode:n.PANELCONTENT,headerContent:"Edit "+i,width:1e3,zIndex:5,centered:!0,modal:!0,visible:!1,render:!0,plugins:[]});e.one(n.PANELCONTENT).getY()<50&&e.one(n.PANELCONTENT).setY(50),l.show();var c=new e.Anim({node:e.UA.gecko?"html":"body",to:{scrollTop:a.getY()},duration:.5,easing:e.Easing.easeBoth});c.run(),e.fire("domready"),e.one(n.CANCELBUTTON).on("click",function(e){e.preventDefault(),l.hide()}),e.one(n.CANCELBUTTON2).on("click",function(e){e.preventDefault(),l.hide()})},on_click:function(t,n){t.preventDefault();var r=this.get("href")+"&isformajax=2",i={on:{success:n[0].show_form},arguments:n};e.io(r,i)},init:function(){M.course.coursebase.register_module(this)},setupDialog:function(t,r){if(typeof t._event!="undefined"&&typeof r!="undefined"&&r[0]==e.all(n.INITBUTTON).size())e.later(500,this,this.setupDialog,[t,r]);else{t=typeof r!="undefined"?r[1]:t;var i=e.all(n.INITBUTTON);for(var s=0;s<i.size();s++)i.item(s).detach("click"),i.item(s).on("click",this.on_click,i.item(s),[this,t]);this.setupDuplicate(t)}},setupDuplicate:function(t){var r=e.all(n.DUPLICATEBUTTON),i=e.all(n.INITBUTTON).size();for(var s=0;s<r.size();s++)r.item(s).once("click",this.setupDialog,this,[i,t])}},{NAME:r,ATTRS:{maxheight:{value:800}}}),M.course=M.course||{},M.course.dialogupdate=function(e){return new i(e)}},"@VERSION@",{requires:["io-base","io-form","anim","moodle-course-coursebase"]});
